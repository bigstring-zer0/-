# 마법의 숲 탐색

## 문제

정령들이 R행 C열의 격자 형태로 이루어진 마법의 숲을 탐색하려고 합니다. 격자는 가장 위를 1행, 가장 아래를 R행으로 합니다.

숲의 동쪽, 서쪽, 남쪽은 마법의 벽으로 막혀 있으며, 정령들은 숲의 북쪽을 통해서만 숲에 들어올 수 있습니다.

총 K명의 정령은 각자 골렘을 타고 숲을 탐색합니다. 각 골렘은 십자 모양의 구조를 가지고 있으며, 중앙 칸을 포함해 총 5칸을 차지합니다. 골렘의 중앙을 제외한 4칸 중 한 칸은 골렘의 출구입니다. 정령은 어떤 방향에서든 골렘에 탑승할 수 있지만 골렘에서 내릴 때에는 정해진 출구를 통해서만 내릴 수 있습니다.

i번째로 숲을 탐색하는 골렘은 숲의 가장 북쪽에서 시작해 골렘의 중앙이 c
i
​
열이 되도록 하는 위치에서 내려오기 시작합니다. 초기 골렘의 출구는 d
i
​
의 방향에 위치해 있습니다.

골렘은 숲을 탐색하기 위해 다음과 같은 우선순위로 이동합니다. 더 이상 움직이지 못할 때까지 해당 과정을 반복합니다.

(1) 남쪽으로 한 칸 내려갑니다.

![085f4c7c-d9d2-43cb-b117-1c5ace835a64](https://github.com/meanzi3/codetree-TILs/assets/120402129/3e296c31-2782-4615-92c9-29b60df5653a)

위 그림의 초록색 칸들이 비어있을 때에만 남쪽으로 내려갈 수 있습니다.

(2) (1)의 방법으로 이동할 수 없으면 서쪽 방향으로 회전하면서 내려갑니다.

![2d921c37-c98c-4fc0-ab16-699d59c71ac8](https://github.com/meanzi3/codetree-TILs/assets/120402129/ca14b856-d3b9-4f01-bfc2-bd7796eabc42)

위 그림의 초록색 칸들이 비어있을 때에만 서쪽 방향으로 회전하면서 내려갈 수 있습니다. 이 때 서쪽 방향으로 한 칸 이동을 한 뒤 내려가기 때문에 골렘을 기준으로 서쪽 한 칸이 모두 비어 있어야 함에 유의합니다. 또한 이렇게 이동할 때 출구가 반시계방향으로 이동합니다.

(3) (1)과 (2)의 방법으로 이동할 수 없으면 동쪽 방향으로 회전하면서 내려갑니다.

![a4ca5d07-3e7f-443e-8d63-a2f0b484b70b](https://github.com/meanzi3/codetree-TILs/assets/120402129/446e15e2-fe20-4aad-976e-54a39218923b)

위 그림의 초록색 칸들이 비어있을 때에만 동쪽 방향으로 회전하면서 내려갈 수 있습니다. 이 때 동쪽 방향으로 한 칸 이동을 한 뒤 내려가기 때문에 골렘을 기준으로 동쪽 한 칸이 모두 비어 있어야 함에 유의합니다. 또한 이렇게 이동할 때 출구가 시계방향으로 이동합니다.

골렘이 이동할 수 있는 가장 남쪽에 도달해 더이상 이동할 수 없으면 정령은 골렘 내에서 상하좌우 인접한 칸으로 이동이 가능합니다. 단, 만약 현재 위치하고 있는 골렘의 출구가 다른 골렘과 인접하고 있다면 해당 출구를 통해 다른 골렘으로 이동할 수 있습니다.

정령은 갈 수 있는 모든 칸 중 가장 남쪽의 칸으로 이동하고 이동을 완전히 종료합니다. 이때 정령의 위치가 해당 정령의 최종 위치가 됩니다. 아래 그림에서는 정령이 출구를 타고 6번째 행까지 이동이 가능합니다.

![4e89edb0-5f98-4ffe-8ea3-26bce65c6536](https://github.com/meanzi3/codetree-TILs/assets/120402129/c9b847da-e200-4608-848b-666d89ba2931)

이 문제에서는 정령의 최종 위치의 행 번호의 합을 구해야 하기에 각 정령이 도달하게 되는 최종 위치를 누적해야 합니다.

아래의 그림처럼 만약 골렘이 최대한 남쪽으로 이동했지만 골렘의 몸 일부가 여전히 숲을 벗어난 상태라면, 해당 골렘을 포함해 숲에 위치한 모든 골렘들은 숲을 빠져나간 뒤 다음 골렘부터 새롭게 숲의 탐색을 시작합니다. <strong>단, 이 경우에는 정령이 도달하는 최종 위치를 답에 포함시키지 않습니다.</strong>

![db1ba238-8326-4667-9c33-df8b008ca0d3](https://github.com/meanzi3/codetree-TILs/assets/120402129/e2874ad5-16e7-40b5-b8b4-e03387f142ba)

즉, 아래와 같이 숲이 텅 빈 상태에서 다음 골렘이 탐색을 시작합니다.

![d865029f-98d6-40bc-bb7e-a4a5d587f30c](https://github.com/meanzi3/codetree-TILs/assets/120402129/4a258e93-2a6b-4181-b569-769d53463879)

골렘들이 숲에 진입함에 따라 각 정령들이 최종적으로 위치한 행의 총합을 구하는 프로그램을 작성하세요. 숲이 다시 텅 비게 돼도 행의 총합은 누적되는 것에 유의합니다.

<br>

## 입력 형식

첫 번째 줄에는 숲의 크기를 의미하는 `R`, `C`, 정령의 수 `K`가 공백을 사이에 두고 주어집니다.

그다음 줄부터 `K`개의 줄에 거쳐 각 골렘이 출발하는 열 `ci`, 골렘의 출구 방향 정보 `di`가 공백을 사이에 두고 주어집니다.

골렘의 출구 방향 정보 `di`는 0과 3 사이의 수로 주어지며 각각의 숫자 0,1,2,3은 북, 동, 남, 서쪽을 의미합니다.

- 5 ≤ `R`,`C` ≤ 70
- 1 ≤ `K` ≤ 1000
- 2 ≤ `c`
- `i` ≤ `C`−1
- 0 ≤ `di` ≤3

<br>

## 출력 형식

첫번째 줄에 각 정령들이 최종적으로 위치한 행의 총합을 출력하세요.

### 입출력 예제

#### 예제1

입력:

```
6 5 6
2 3
2 0
4 2
2 0
2 0
2 2
```

#### 출력:

```
29
```

### 예제2

#### 입력:

```
7 9 6
4 1
5 1
2 1
8 1
2 2
6 0
```

#### 출력:

```
37
```

<br>

### 예제 설명

---

첫 번째 예제에 대해 자세히 알아보겠습니다.

첫번째로 중앙이 2열, 출구가 서쪽인 골렘이 내려옵니다. 골렘이 가장 남쪽으로 이동했을 때 다음과 같이 이동합니다.

![0638b01a-6799-4e09-914d-c6421af5e531](https://github.com/meanzi3/codetree-TILs/assets/120402129/4c262075-a92f-4569-8788-f5c4af8ae67a)

골렘이 도착하고 난 뒤, 정령이 가장 남쪽으로 이동했을 때의 행 번호는 다음과 같이 6입니다. (답에 +6)

![58210c64-56e7-4445-8918-f9bc023437c5](https://github.com/meanzi3/codetree-TILs/assets/120402129/439366e0-5362-472e-a29b-c691804352cc)

그다음으로 중앙이 2열, 출구가 북쪽인 골렘이 내려옵니다. 골렘이 가장 남쪽으로 이동했을 때 다음과 같이 이동합니다. 골렘이 중간에 동쪽으로 두 번 회전하여 출구가 남쪽으로 바뀌게 됩니다.

![34912f26-e903-482f-a66d-94cfbd47f652](https://github.com/meanzi3/codetree-TILs/assets/120402129/1b5e00c8-c69e-44ef-aff7-be08c081086f)

골렘이 도착하고 난 뒤, 정령이 가장 남쪽으로 이동했을 때의 행 번호는 다음과 같이 6입니다. (답에 +6)

![8c54172c-ed38-4231-b594-8b30512f845e](https://github.com/meanzi3/codetree-TILs/assets/120402129/d9beff00-c96e-4c06-9ffb-78b69f592cfc)

그다음으로 중앙이 4열, 출구가 남쪽인 골렘이 내려옵니다. 골렘이 가장 남쪽으로 이동했을 때 다음과 같이 이동합니다. 골렘이 중간에 서쪽으로 한 번 회전하여 출구가 동쪽으로 바뀌게 됩니다.

![b23d7e31-eaca-48ea-ad51-df6eac057bb5](https://github.com/meanzi3/codetree-TILs/assets/120402129/5daf859a-d299-4c37-892f-8ce450d837f2)

골렘이 도착하고 난 뒤, 정령이 가장 남쪽으로 이동했을 때의 행 번호는 다음과 같이 6입니다. (답에 +6)

![da1452d7-d148-4e79-9471-106eba28be5c](https://github.com/meanzi3/codetree-TILs/assets/120402129/7b3c1ea2-bf16-46c5-ba49-c215f3c9d8d9)

그다음으로 중앙이 2열, 출구가 북쪽인 골렘이 내려옵니다. 골렘이 가장 남쪽으로 이동했을 때 다음과 같이 이동합니다.

![20931046-f0e5-41f1-855b-405be156b8ce](https://github.com/meanzi3/codetree-TILs/assets/120402129/10c26379-1888-4602-8f91-654f165c8fcb)

골렘이 가장 남쪽으로 내려와도, 골렘의 몸의 일부가 숲을 벗어나있기 때문에 숲에 위치한 모든 골렘들은 숲을 빠져나가게 됩니다. 이 때, 점수는 더해지지 않음에 유의합니다.

그다음으로 중앙이 2열, 출구가 북쪽인 골렘이 내려옵니다. 골렘이 가장 남쪽으로 이동했을 때 다음과 같이 이동합니다.

![e83b09f3-0915-4b1e-bc8c-046dc337391f](https://github.com/meanzi3/codetree-TILs/assets/120402129/c38dfe6c-c1f4-4ad5-a59f-36afdf23d690)

골렘이 도착하고 난 뒤, 정령이 가장 남쪽으로 이동했을 때의 행 번호는 다음과 같이 6입니다. (답에 +6)

![ba175c9d-b94c-4593-b8d9-585c2b3f396e](https://github.com/meanzi3/codetree-TILs/assets/120402129/f7cfb730-a5a7-49dd-b65b-1ca54dc813e1)

마지막으로 중앙이 2열, 출구가 남쪽인 골렘이 내려옵니다. 골렘이 가장 남쪽으로 이동했을 때 다음과 같이 이동합니다. 골렘이 중간에 동쪽으로 두 번 회전하여 출구가 북쪽으로 바뀌게 됩니다.

![e2f8d84a-6053-4bb5-8fcd-c00a616ecc5a](https://github.com/meanzi3/codetree-TILs/assets/120402129/4c1efdfc-be88-489a-bcca-e751ab7c3791)

골렘이 도착하고 난 뒤, 정령이 가장 남쪽으로 이동했을 때의 행 번호는 다음과 같이 5입니다. (답에 +5)

![895a5355-fb70-463f-8b4b-1fd944c144db](https://github.com/meanzi3/codetree-TILs/assets/120402129/d6e6aa7d-5674-4df2-a7be-acb03ef2be31)

각 정령들이 최종적으로 위치한 행의 총합은 6+6+6+6+5=29입니다.
<br><br><br>

---

#### 제한

```
시간 제한: 1000ms
메모리 제한: 80MB
```
